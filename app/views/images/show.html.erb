<div class="mx-auto w-full mt-4 pb-6 px-2" data-controller="opensymbols">
  <% if current_user.admin? %>
  <div class="flex justify-between">
      <%= link_to "Previous Image", image_path(@image.id - 1), class: "text-blue-500 hover:text-blue-700 font-medium py-2 px-4 rounded-md" %>
              <%= button_to "Create Symbol", create_symbol_image_path(@image), class: "text-white bg-blue-500 hover:bg-blue-700 font-bold py-2 px-4 rounded" if current_user.admin? && @image.open_symbol_status == "active" %>
      <%= link_to "Next Image", image_path(@image.id + 1), class: "text-blue-500 hover:text-blue-700 font-medium py-2 px-4 rounded-md" %>
  </div>
  <% end %>
  <h1 class="text-2xl md:text-3xl font-bold text-blue-600 m-1 text-center">
    <%= @image.label&.titleize %>
  </h1>
  <div class="flex justify-center">
    <div class="justify-start my-2 py-3">
      <p class="text-center text-sm text-gray-400 my-1">
        This image is currently being used in the following boards:
      <% @user_image_boards.each do |board| %>
        <%= link_to "#{board.name&.upcase}", board_path(board), class: "text-md font-bold text-blue-600 hover:underline block m-3" %>
      <% end %>

      <p><%= @image.display_description %></p>
      <% if current_user.boards.any? %>
      <%= form_with url: add_to_board_image_path(@image), method: :post do |f| %>
      <p class="text-center text-sm text-gray-400 my-1">
        Add this image to one of your boards.
      </p>
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
        <%= f.hidden_field :image_id, value: @image.id %>
        <%= f.collection_select :board_id, current_user.non_menu_boards, :id, :name, {prompt: "Select a board"}, class: "inline-block w-5/6 m-1" %>
        <%= f.submit "Add", class: "inline-block text-white bg-blue-500 hover:bg-blue-700 font-bold py-2 px-4 rounded" %>
      </div>
      <% end %>
      <% else %>
        <%= link_to "Create a board", new_board_path, class: "inline-block text-white bg-blue-500 hover:bg-blue-700 font-bold py-2 px-4 rounded" %>
      <% end %>
    </div>
  </div>

<div class="mx-auto flex flex-col md:flex-row justify-center items-center">
    <div class="w-full md:w-1/4 p-4">
      <%= render "images/doc_form", image: @image %>
    </div>
    <div class="w-full md:w-1/4 p-4">
      <h2 class="text-xl font-semibold my-6">OR</h2>
      <div class="">
        <%= @image.generating? ? loading_spinner : "" %>
      </div>
      <%= link_to image_path(@image), class: "text-center text-xs mt-2 hidden", id: "pleaseWait" do %>
      <div class="bg-green-500 p-6 rounded-lg text-white mb-3">
        <p class="text-center">Please wait while we process your image...</p>
        <div class="flex justify-center mt-4">
          <span class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-white">
          </span>
        </div>
        <p class="text-center text-xs mt-2">This could take a minute. Please click here to refresh the page if not redirected in 30 seconds.</p>
      </div>
      <% end %>
    </div>

    <div class="w-full md:w-1/3 p-4">
      <%  if @image.status == "error" %>
          <div class="bg-red-600 p-8 m-2 rounded-lg text-white text-center">
            <%= current_user.admin? ? @image.error : "Image generation has been disabled for this item. <hr><br>Please try again later or contact the administrator if this problem persists.".html_safe %>
          </div>
      <% elsif current_user.tokens < 1 %>
      <%= link_to products_path, class: "text-center text-xs mt-2" do %>
          <div class="bg-red-600 p-3 m-2 rounded-lg text-white text-center">
            You have no tokens left. Please purchase more tokens to generate more images.
          </div>
      <% end %>
      <% else %>
      <%= render "images/generate_image", image: @image %>
      <% end %>

    </div>
  </div>
  <div class="mx-auto w-3/4 mt-4 pb-6">

  <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-1 mt-6" id="<%=@image.id%>_docs_list">
    <% @image_docs.each do |doc| %>
      <%= render "docs/doc", doc: doc, viewing_user: current_user %>
    <% end %>
  </div>
  </div>
</div>

  <div class="mt-6 flex justify-center space-x-4">
    <%= button_to "Edit this image", edit_image_path(@image), method: :get, class: "text-blue-500 hover:text-blue-700 font-medium py-2 px-4 rounded-md" if current_user.can_edit?(@image) %>
    <%= button_to "Destroy this image", @image, method: :delete, class: "text-red-500 hover:text-red-700 font-medium py-2 px-4 rounded-md", data: { turbo_method: :delete, turbo_confirm: "Are you sure?"} if current_user.can_edit?(@image) %>
  </div>
</div>

  